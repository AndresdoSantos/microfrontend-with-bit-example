{"ast":null,"code":"\"use strict\";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k];}});}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v});}:function(o,v){o[\"default\"]=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{\"default\":mod};};Object.defineProperty(exports,\"__esModule\",{value:true});exports.ComponentCompare=void 0;const component_1=require(\"@teambit/component\");const ui_foundation_ui_react_router_slot_router_1=require(\"@teambit/ui-foundation.ui.react-router.slot-router\");const lodash_flatten_1=__importDefault(require(\"lodash.flatten\"));const base_react_navigation_link_1=require(\"@teambit/base-react.navigation.link\");const design_ui_round_loader_1=require(\"@teambit/design.ui.round-loader\");const react_1=__importStar(require(\"react\"));const component_compare_context_1=require(\"./component-compare-context\");const component_compare_version_picker_1=require(\"./version-picker/component-compare-version-picker\");const use_component_compare_url_1=require(\"./use-component-compare-url\");const blank_state_1=require(\"./blank-state\");const component_compare_module_scss_1=__importDefault(require(\"./component-compare.module.scss\"));const findPrevVersionFromCurrent=compareVersion=>(_,index,logs)=>{if(index===0)return false;if(logs.length===1)return true;const prevIndex=index-1;return logs[prevIndex].tag===compareVersion||logs[prevIndex].hash===compareVersion;};const groupByVersion=(accum,current)=>{if(!accum.has(current.tag||current.hash)){accum.set(current.tag||current.hash,current);}return accum;};function ComponentCompare({navSlot,host,routeSlot}){var _a,_b;const baseVersion=(0,use_component_compare_url_1.useCompareQueryParam)('baseVersion');const component=(0,react_1.useContext)(component_1.ComponentContext);const location=(0,base_react_navigation_link_1.useLocation)();const isWorkspace=host==='teambit.workspace/workspace';const allVersionInfo=((_a=component.logs)===null||_a===void 0?void 0:_a.slice())||[];const isNew=allVersionInfo.length===0;const compareVersion=isWorkspace&&!isNew&&!(location===null||location===void 0?void 0:location.search.includes('version'))?'workspace':component.id.version;const compareIsLocalChanges=compareVersion==='workspace';const lastVersionInfo=(0,react_1.useMemo)(()=>{const prevVersionInfo=allVersionInfo.find(findPrevVersionFromCurrent(compareVersion));return prevVersionInfo;},[component.logs]);const baseId=baseVersion&&component.id.changeVersion(baseVersion)||lastVersionInfo&&component.id.changeVersion(lastVersionInfo.tag||lastVersionInfo.hash)||component.id;const compare=component;const{component:base,loading}=(0,component_1.useComponent)(host,baseId.toString());const nothingToCompare=!loading&&!compareIsLocalChanges&&(((_b=component.logs)===null||_b===void 0?void 0:_b.length)||[])<2;const showSubMenus=!loading&&!nothingToCompare;const logsByVersion=(0,react_1.useMemo)(()=>allVersionInfo.reduce(groupByVersion,new Map()),[compare.id,baseId]);const componentCompareModel={compare:{model:compare,hasLocalChanges:compareIsLocalChanges},base:base&&{model:base},loading,logsByVersion};return react_1.default.createElement(component_compare_context_1.ComponentCompareContext.Provider,{value:componentCompareModel},react_1.default.createElement(\"div\",{className:component_compare_module_scss_1.default.componentCompareContainer},loading&&react_1.default.createElement(\"div\",{className:component_compare_module_scss_1.default.loader},react_1.default.createElement(design_ui_round_loader_1.RoundLoader,null)),showSubMenus&&react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement(\"div\",{className:component_compare_module_scss_1.default.top},react_1.default.createElement(component_compare_version_picker_1.ComponentCompareVersionPicker,null)),react_1.default.createElement(\"div\",{className:component_compare_module_scss_1.default.bottom},react_1.default.createElement(CompareMenuNav,{navSlot:navSlot}),react_1.default.createElement(ui_foundation_ui_react_router_slot_router_1.SlotRouter,{slot:routeSlot}))),nothingToCompare&&react_1.default.createElement(blank_state_1.ComponentCompareBlankState,null)));}exports.ComponentCompare=ComponentCompare;function CompareMenuNav({navSlot}){const plugins=(0,lodash_flatten_1.default)(navSlot.toArray().map(([id,values])=>{const flattenedValues=(0,lodash_flatten_1.default)(values).map(value=>Object.assign(Object.assign({},value),{id}));return flattenedValues;})).sort(sortFn);return react_1.default.createElement(\"div\",{className:component_compare_module_scss_1.default.navContainer},react_1.default.createElement(\"nav\",{className:component_compare_module_scss_1.default.navigation},plugins.map((menuItem,index)=>{return react_1.default.createElement(component_1.TopBarNav,Object.assign({key:`${menuItem.id}-${index}`},menuItem.props));})));}function sortFn({order:first},{order:second}){return(first!==null&&first!==void 0?first:0)-(second!==null&&second!==void 0?second:0);}","map":null,"metadata":{},"sourceType":"module"}