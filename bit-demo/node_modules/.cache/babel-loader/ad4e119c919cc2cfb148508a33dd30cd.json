{"ast":null,"code":"\"use strict\";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k];}});}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v});}:function(o,v){o[\"default\"]=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{\"default\":mod};};Object.defineProperty(exports,\"__esModule\",{value:true});exports.FilterWidget=exports.TreeToggleWidget=exports.ComponentsDrawer=void 0;const react_1=__importStar(require(\"react\"));const classnames_1=__importDefault(require(\"classnames\"));const ui_foundation_ui_side_bar_1=require(\"@teambit/ui-foundation.ui.side-bar\");const design_ui_styles_muted_italic_1=require(\"@teambit/design.ui.styles.muted-italic\");const design_ui_styles_ellipsis_1=require(\"@teambit/design.ui.styles.ellipsis\");const base_ui_utils_composer_1=require(\"@teambit/base-ui.utils.composer\");const lodash_flatten_1=__importDefault(require(\"lodash.flatten\"));const component_ui_component_filters_component_filter_context_1=require(\"@teambit/component.ui.component-filters.component-filter-context\");const lanes_hooks_use_lanes_1=require(\"@teambit/lanes.hooks.use-lanes\");const design_ui_skeletons_sidebar_loader_1=require(\"@teambit/design.ui.skeletons.sidebar-loader\");const component_drawer_filter_widget_context_1=require(\"./component-drawer-filter-widget.context\");const component_drawer_tree_widget_context_1=require(\"./component-drawer-tree-widget.context\");const component_drawer_module_scss_1=__importDefault(require(\"./component-drawer.module.scss\"));class ComponentsDrawer{constructor(props){var _a;this.Context=({children})=>{var _a,_b;const filters=(0,lodash_flatten_1.default)(((_b=(_a=this.plugins)===null||_a===void 0?void 0:_a.filters)===null||_b===void 0?void 0:_b.values())||[]);const combinedContexts=[component_drawer_tree_widget_context_1.ComponentTreeProvider,component_drawer_filter_widget_context_1.ComponentFilterWidgetProvider,[component_ui_component_filters_component_filter_context_1.ComponentFiltersProvider,{filters}]];return react_1.default.createElement(base_ui_utils_composer_1.Composer,{components:combinedContexts},children);};this.renderFilters=({components,lanes})=>{const{filterWidgetOpen}=(0,react_1.useContext)(component_drawer_filter_widget_context_1.ComponentFilterWidgetContext);const filterPlugins=this.plugins.filters;const filters=(0,react_1.useMemo)(()=>filterPlugins&&(0,lodash_flatten_1.default)(filterPlugins.toArray().map(([key,filtersByKey])=>{return filtersByKey.map(filter=>Object.assign(Object.assign({},filter),{key:`${key}-${filter.id}`}));})).sort((a,b)=>{var _a,_b;return((_a=a.order)!==null&&_a!==void 0?_a:0)-((_b=b.order)!==null&&_b!==void 0?_b:0);})||[],[filterPlugins]);return react_1.default.createElement(\"div\",{className:(0,classnames_1.default)(component_drawer_module_scss_1.default.filtersContainer,filterWidgetOpen&&component_drawer_module_scss_1.default.open)},filters.map(filter=>react_1.default.createElement(filter.render,{key:filter.key,components:components,lanes:lanes,className:(0,classnames_1.default)(component_drawer_module_scss_1.default.filter,filterWidgetOpen&&component_drawer_module_scss_1.default.open)})));};this.renderTree=({components,host})=>{const{collapsed}=(0,react_1.useContext)(component_drawer_tree_widget_context_1.ComponentTreeContext);const{tree}=this.plugins;const TreeNode=(tree===null||tree===void 0?void 0:tree.customRenderer)&&(0,react_1.useCallback)(tree.customRenderer(tree.widgets,host),[tree.widgets]);const isVisible=components.length>0;if(!isVisible)return null;return react_1.default.createElement(\"div\",{className:component_drawer_module_scss_1.default.drawerTreeContainer},react_1.default.createElement(ui_foundation_ui_side_bar_1.ComponentTree,{transformTree:this.transformTree?this.transformTree(host):undefined,components:components,isCollapsed:collapsed,assumeScopeInUrl:this.assumeScopeInUrl,TreeNode:TreeNode}));};this.setWidgets=widgets=>{this.widgets=(0,lodash_flatten_1.default)(widgets===null||widgets===void 0?void 0:widgets.values());};this.render=()=>{var _a;const{loading,components}=this.useComponents();const{lanesModel:lanes}=(0,lanes_hooks_use_lanes_1.useLanes)();const componentFiltersContext=(0,react_1.useContext)(component_ui_component_filters_component_filter_context_1.ComponentFilterContext);const filters=(componentFiltersContext===null||componentFiltersContext===void 0?void 0:componentFiltersContext.filters)||[];const filteredComponents=(0,react_1.useMemo)(()=>(0,component_ui_component_filters_component_filter_context_1.runAllFilters)(filters,{components,lanes}),[filters,components,lanes]);const Filters=this.renderFilters({components,lanes});const host=(_a=this.useHost)===null||_a===void 0?void 0:_a.call(this);const Tree=this.renderTree({components:filteredComponents,host});const emptyDrawer=react_1.default.createElement(\"span\",{className:(0,classnames_1.default)(design_ui_styles_muted_italic_1.mutedItalic,design_ui_styles_ellipsis_1.ellipsis,component_drawer_module_scss_1.default.emptyDrawer)},this.emptyMessage);if(loading)return react_1.default.createElement(design_ui_skeletons_sidebar_loader_1.ComponentTreeLoader,null);return react_1.default.createElement(\"div\",{key:this.id,className:component_drawer_module_scss_1.default.drawerContainer},Filters,Tree,filteredComponents.length===0&&emptyDrawer);};Object.assign(this,props);this.useComponents=props.useComponents;this.emptyMessage=props.emptyMessage;this.plugins=props.plugins||{};this.setWidgets((_a=props.plugins)===null||_a===void 0?void 0:_a.drawerWidgets);this.assumeScopeInUrl=props.assumeScopeInUrl||false;this.useHost=props.useHost;this.transformTree=props.transformTree;}}exports.ComponentsDrawer=ComponentsDrawer;function TreeToggleWidget(){const{collapsed,setCollapsed}=(0,react_1.useContext)(component_drawer_tree_widget_context_1.ComponentTreeContext);const icon=collapsed?'https://static.bit.dev/bit-icons/expand.svg':'https://static.bit.dev/bit-icons/collapse.svg';return react_1.default.createElement(\"div\",{className:(0,classnames_1.default)(component_drawer_module_scss_1.default.widgetIcon,!collapsed&&component_drawer_module_scss_1.default.open)},react_1.default.createElement(\"img\",{src:icon,onClick:()=>setCollapsed(!collapsed)}));}exports.TreeToggleWidget=TreeToggleWidget;function FilterWidget(){const{filterWidgetOpen,setFilterWidget}=(0,react_1.useContext)(component_drawer_filter_widget_context_1.ComponentFilterWidgetContext);return react_1.default.createElement(\"div\",{className:(0,classnames_1.default)(component_drawer_module_scss_1.default.widgetIcon,component_drawer_module_scss_1.default.filterWidget,filterWidgetOpen&&component_drawer_module_scss_1.default.open)},react_1.default.createElement(\"img\",{src:\"https://static.bit.dev/bit-icons/filter.svg\",onClick:()=>setFilterWidget(!filterWidgetOpen)}));}exports.FilterWidget=FilterWidget;","map":null,"metadata":{},"sourceType":"module"}