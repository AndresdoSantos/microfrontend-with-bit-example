{"ast":null,"code":"\"use strict\";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k];}});}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k];});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,\"default\",{enumerable:true,value:v});}:function(o,v){o[\"default\"]=v;});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!==\"default\"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result;};var __rest=this&&this.__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols===\"function\")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]];}return t;};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{\"default\":mod};};Object.defineProperty(exports,\"__esModule\",{value:true});exports.ComponentPreview=void 0;const react_1=__importStar(require(\"react\"));const lodash_1=require(\"lodash\");const penpal_1=require(\"penpal\");const pubsub_1=require(\"@teambit/pubsub\");const urls_1=require(\"./urls\");const compute_preview_scale_1=require(\"./compute-preview-scale\");const use_iframe_content_height_1=require(\"./use-iframe-content-height\");const preview_module_scss_1=__importDefault(require(\"./preview.module.scss\"));/**\n * renders a preview of a component.\n */function ComponentPreview(_a){var _b,_c,_d;var{component,previewName,forceHeight,queryParams,pubsub,// fitView = 1280,\nviewport=1280,fullContentHeight=false,style}=_a,rest=__rest(_a,[\"component\",\"previewName\",\"forceHeight\",\"queryParams\",\"pubsub\",\"viewport\",\"fullContentHeight\",\"style\"]);const[heightIframeRef,iframeHeight]=(0,use_iframe_content_height_1.useIframeContentHeight)({skip:false,viewport});const iframeRef=(0,react_1.useRef)(null);const[width,setWidth]=(0,react_1.useState)(0);const[height,setHeight]=(0,react_1.useState)(0);const containerRef=(0,react_1.useRef)(null);const isScaling=(_b=component.preview)===null||_b===void 0?void 0:_b.isScaling;const currentRef=isScaling?iframeRef:heightIframeRef;// @ts-ignore (https://github.com/frenic/csstype/issues/156)\n// const height = iframeHeight || style?.height;\n(0,pubsub_1.usePubSubIframe)(pubsub?currentRef:undefined);// const pubsubContext = usePubSub();\n// pubsubContext?.connect(iframeHeight);\n(0,react_1.useEffect)(()=>{if(!iframeRef.current)return;(0,penpal_1.connectToChild)({iframe:iframeRef.current,methods:{pub:(event,message)=>{if(message.type==='preview-size'){setWidth(message.data.width);setHeight(message.data.height);}}}});},[iframeRef===null||iframeRef===void 0?void 0:iframeRef.current]);const params=Array.isArray(queryParams)?queryParams.concat(`viewport=${viewport}`):(0,lodash_1.compact)([queryParams,`viewport=${viewport}`]);const targetParams=viewport===null?queryParams:params;const url=(0,urls_1.toPreviewUrl)(component,previewName,isScaling?targetParams:queryParams);// const currentHeight = fullContentHeight ? '100%' : height || 1024;\nconst containerWidth=((_c=containerRef.current)===null||_c===void 0?void 0:_c.offsetWidth)||0;const containerHeight=((_d=containerRef.current)===null||_d===void 0?void 0:_d.offsetHeight)||0;const currentWidth=fullContentHeight?'100%':(width||1280)+10;const legacyCurrentWidth='100%';const targetWidth=currentWidth<containerWidth?containerWidth:currentWidth;const targetHeight=height!==0?height:5000;const finalHeight=!fullContentHeight&&targetHeight<containerHeight?containerHeight:targetHeight;const defaultLegacyHeight=forceHeight||5000;const legacyIframeHeight=(iframeHeight||0)>400?iframeHeight:defaultLegacyHeight;return react_1.default.createElement(\"div\",{ref:containerRef,className:preview_module_scss_1.default.preview,style:{height:forceHeight}},react_1.default.createElement(\"iframe\",Object.assign({},rest,{ref:currentRef,style:Object.assign(Object.assign({},style),{height:forceHeight||(isScaling?finalHeight:legacyIframeHeight),width:isScaling?targetWidth:legacyCurrentWidth,visibility:width===0&&isScaling&&!fullContentHeight?'hidden':undefined,transform:fullContentHeight?'':(0,compute_preview_scale_1.computePreviewScale)(width,containerWidth),border:0,transformOrigin:'top left'}),src:url})));}exports.ComponentPreview=ComponentPreview;","map":null,"metadata":{},"sourceType":"module"}